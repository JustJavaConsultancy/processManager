<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <title>Chat</title>
    <style>
        .chat-collapsed .chat-sidebar { display: none !important; }
        .chat-collapsed .chat-main { width: 100% !important; }
        @media (max-width: 768px) {
            .chat-sidebar { display: none; }
            .chat-sidebar.active { display: block; position: absolute; z-index: 50; width: 80vw; left: 0; top: 0; height: 100%; background: #1e293b; }
        }
        /* Hide AI support chat button on chat page */
        #support-chat-btn {
            display: none !important;
        }
        /* Video call modal styles */
        #video-call-modal .video-container {
            width: 100%;
            height: 80vh;
            min-height: 500px;
        }
    </style>
</head>
<body>
<section layout:fragment="content" class="flex flex-col md:flex-row h-full relative" id="chat-root">
    <!-- Sidebar Collapse Button (mobile/desktop) -->
    <button id="sidebar-toggle" class="absolute top-4 left-4 z-50 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2 md:hidden" title="Toggle Sidebar">
        <span class="material-icons">menu</span>
    </button>
    <!-- Conversations Sidebar -->
    <div th:replace="chat/sidebar.html"></div>
    <!-- Chat Window -->
    <main class="chat-main flex-1 flex flex-col h-full bg-slate-50 dark:bg-slate-900 transition-all duration-200">
        <div th:replace="chat/header.html"></div>
        <div th:replace="chat/messages.html"></div>
        <div th:replace="chat/input.html"></div>
    </main>
    <div th:replace="chat/new-chat-modal.html"></div>
    
    <!-- Video Call Modal -->
    <div id="video-call-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-6xl h-full max-h-[90vh] shadow-lg border border-slate-200 dark:border-slate-700 flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700">
                <div class="flex items-center space-x-3">
                    <span class="material-icons text-blue-600">videocam</span>
                    <div>
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white">Video Call</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400" id="video-call-participant">with <span id="video-call-with"></span></p>
                    </div>
                </div>
                <button id="end-video-call" class="text-slate-400 hover:text-red-600 dark:text-slate-300 dark:hover:text-red-400 p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" title="End Call">
                    <span class="material-icons">call_end</span>
                </button>
            </div>
            
            <!-- Video Container -->
            <div class="flex-1 p-4">
                <div id="video-call-container" class="video-container bg-slate-100 dark:bg-slate-700 rounded-lg"></div>
            </div>
            
            <!-- Call Status -->
            <div id="video-call-status" class="hidden p-4 text-center border-t border-slate-200 dark:border-slate-700">
                <div class="text-slate-600 dark:text-slate-400">
                    <span class="material-icons animate-pulse">videocam</span>
                    <span class="ml-2">Connecting to video call...</span>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/videocall.js"></script>
</section>
</body>
</html> 