<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Invoices</title>
    <style>
        .dropdown-menu {
            position: absolute;
            right: 0;
            margin-top: 0.5rem;
            min-width: 120px;
            z-index: 50;
            background-color: #1e293b;
            border: 1px solid #334155;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .dropdown-container {
            position: relative;
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        .dropdown-item {
            display: block;
            width: 100%;
            padding: 0.5rem 1rem;
            text-align: left;
            transition: background-color 0.2s;
        }
        .dropdown-item:hover {
            background-color: #374151;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-white">Invoices</h1>
            <a th:href="@{/invoices/create}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Create New Invoice
            </a>
        </div>

        <!-- Alert Messages -->
        <div th:if="${param.error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6">
            <span class="block sm:inline" th:text="${param.error}">Error message here</span>
        </div>
        <div th:if="${param.success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6">
            <span class="block sm:inline" th:text="${param.success}">Success message here</span>
        </div>

        <!-- Invoice List -->
        <div class="bg-slate-800 shadow-md rounded-lg p-6">
            <div class="space-y-4">
                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(invoices)}" class="text-center py-8">
                    <p class="text-slate-400">No invoices found. Create your first invoice!</p>
                </div>

                <!-- Invoice Cards -->
                <div th:each="invoice : ${invoices}" class="bg-slate-700 rounded-lg p-4 hover:bg-slate-600 transition-colors">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-lg font-semibold text-white" th:text="${'Invoice #' + invoice.invoiceNumber}">Invoice #001</h3>
                            <p class="text-slate-400" th:text="${'Client: ' + invoice.clientName}">Client: Oluwaseun Adebayo</p>
                            <p class="text-slate-400" th:text="${invoice.clientEmail}">oluwaseun.adebayo@email.com</p>
                            <p class="text-2xl font-bold text-white mt-2">â‚¦<span th:text="${#numbers.formatDecimal(invoice.amount, 0, 'COMMA', 2, 'POINT')}">750,000.00</span></p>
                            <p class="text-slate-400" th:text="${'Due: ' + #temporals.format(invoice.dueDate, 'MMM dd, yyyy')}">Due: Jan 30, 2025</p>
                        </div>
                        <div class="flex flex-col items-end">
                            <span th:class="${'px-2 py-1 text-xs font-semibold rounded-full mb-4 ' + 
                                (invoice.status == 'PAID' ? 'bg-green-100 text-green-800' : 
                                (invoice.status == 'PENDING' ? 'bg-yellow-100 text-yellow-800' : 
                                (invoice.status == 'OVERDUE' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800')))}"
                                  th:text="${invoice.status}">
                                PENDING
                            </span>
                            <div class="dropdown-container">
                                <button onclick="toggleDropdown(this)" class="text-slate-400 hover:text-white p-2 rounded-full hover:bg-slate-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                                <div class="hidden dropdown-menu">
                                    <a th:href="@{/invoices/{id}(id=${invoice.id})}" 
                                       class="dropdown-item text-blue-400 hover:text-blue-300">View</a>
                                    <a th:href="@{/invoices/edit/{id}(id=${invoice.id})}"
                                       class="dropdown-item text-green-400 hover:text-green-300">Edit</a>
                                    <form th:action="@{/invoices/delete/{id}(id=${invoice.id})}" method="post" class="block">
                                        <button type="submit" onclick="return confirm('Are you sure you want to delete this invoice?');"
                                                class="dropdown-item text-red-400 hover:text-red-300 w-full text-left">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for dropdown functionality -->
    <script>
        function toggleDropdown(button) {
            // Close all other dropdowns first
            const allDropdowns = document.querySelectorAll('.dropdown-menu');
            const allArrows = document.querySelectorAll('.dropdown-container svg');
            
            allDropdowns.forEach(dropdown => {
                if (dropdown !== button.nextElementSibling) {
                    dropdown.classList.add('hidden');
                }
            });
            
            allArrows.forEach(arrow => {
                if (arrow !== button.querySelector('svg')) {
                    arrow.classList.remove('rotate-180');
                }
            });

            // Toggle the clicked dropdown
            const dropdown = button.nextElementSibling;
            const arrow = button.querySelector('svg');
            
            dropdown.classList.toggle('hidden');
            arrow.classList.toggle('rotate-180');

            // Close dropdown when clicking outside
            const closeDropdown = (event) => {
                if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                    dropdown.classList.add('hidden');
                    arrow.classList.remove('rotate-180');
                    document.removeEventListener('click', closeDropdown);
                }
            };

            if (!dropdown.classList.contains('hidden')) {
                // Add event listener with a slight delay to prevent immediate closing
                setTimeout(() => {
                    document.addEventListener('click', closeDropdown);
                }, 0);
            }
        }

        // Close dropdowns when clicking anywhere else on the page
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown-container')) {
                const dropdowns = document.querySelectorAll('.dropdown-menu');
                const arrows = document.querySelectorAll('.dropdown-container svg');
                
                dropdowns.forEach(dropdown => dropdown.classList.add('hidden'));
                arrows.forEach(arrow => arrow.classList.remove('rotate-180'));
            }
        });
    </script>
</div>
</body>
</html> 