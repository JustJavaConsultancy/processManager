<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Past Processes</title>
  <style>
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.5);
    }

    .timeline-circle {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .timeline-circle-inactive {
      border: 2px solid #94a3b8;
      background-color: transparent;
    }

    .timeline-circle-active {
      border: 2px solid #3B82F6;
      background-color: #3B82F6;
    }
  </style>
</head>
<body>
<div layout:fragment="content" class="flex-1 p-4 md:p-6 overflow-y-auto">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
    <div class="mb-4 md:mb-0">
      <h2 class="text-2xl md:text-3xl font-bold text-white mb-1">Past Processes</h2>
      <p class="text-slate-400">Review the history of your completed and active processes</p>
    </div>
    <div class="w-full md:w-auto">
      <input type="text" class="search-input rounded-full px-4 py-2 w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search">
    </div>
  </div>

  <!-- Empty State -->
  <div th:if="${#lists.isEmpty(processes)}" class="processes-card text-center p-8" style="height: auto;">
    <div class="mb-4">
      <i class="fas fa-history text-4xl text-slate-500 opacity-50"></i>
    </div>
    <h3 class="text-xl font-medium text-slate-300 mb-2">No Process History</h3>
    <p class="text-slate-400 mb-6">No processes have been executed yet. Process instances will appear here once workflows are started.</p>
    <div class="flex flex-col sm:flex-row justify-center gap-3">
      <a th:href="@{/processes/newProcess}" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg flex items-center justify-center">
        <i class="fas fa-rocket mr-2"></i>Start First Process
      </a>
    </div>
  </div>

  <!-- Process Cards Grid -->
  <div th:if="${!#lists.isEmpty(processes)}">
    <div th:each="process : ${processes}" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Completed Process Card -->
      <div class="h-full">
        <div class="processes-card p-4 rounded-xl h-full">
          <div class="card-content">
            <div class="flex justify-between items-start mb-3">
              <div class="flex-grow-1">
                <h3 class="font-bold text-lg text-white mb-1" th:text="${process.processDefinitionName}">Employee Onboarding</h3>
                <p th:text="${'Process ID: ' + process.id}" class="text-slate-400 text-sm">Process ID: PI-2023-001</p>
              </div>
              <span class="status-pill "
                    th:classappend="${process.ended ? 'status-completed' : 'status-inprogress'}"
                    th:text="${process.ended ? 'COMPLETED' : 'ACTIVE'}"
              >COMPLETED</span>
            </div>

            <div class="space-y-3 mb-4">
              <div class="flex items-center">
                <i class="fas fa-calendar-alt text-slate-400 mr-3 w-4"></i>
                <div>
                  <p class="text-xs text-slate-400">Started</p>
                  <p th:text="${process.startTime}" class="text-sm font-medium">2023-01-15 09:30</p>
                </div>
              </div>
              <div th:if="${process.ended}" class="flex items-center">
                <i class="fas fa-check-circle text-green-400 mr-3 w-4"></i>
                <div>
                  <p class="text-xs text-slate-400">Completed</p>
                  <p th:text="${process.endTime ?: 'Recently'}" class="text-sm font-medium">2023-01-20 16:45</p>
                </div>
              </div>
              <div th:unless="${process.ended}" class="flex items-center">
                <i class="fas fa-clock text-yellow-400 mr-3 w-4"></i>
                <div>
                  <p class="text-xs text-slate-400">Status</p>
                  <p class="text-sm font-medium">In Progress</p>
                </div>
              </div>
              <div class="flex items-center">
                <i class="fas fa-key text-slate-400 mr-3 w-4"></i>
                <div>
                  <p class="text-xs text-slate-400">Business Key</p>
                  <p th:text="${process.businessKey}" class="text-sm font-medium">EMP-2023-001</p>
                </div>
              </div>
            </div>
          </div>

          <div class="flex justify-between items-center pt-3 border-t border-slate-700">
            <div th:if="${process.ended}" class="text-slate-400 text-sm">
              <i class="fas fa-tasks mr-1"></i><span th:text="${process.taskCount ?: '0'}">3</span> tasks
            </div>
            <div th:unless="${process.ended}" class="text-slate-400 text-sm">
              <i class="fas fa-spinner mr-1"></i> Running
            </div>
            <div class="relative">
              <button class="dropdown-toggle text-slate-400 hover:text-white p-1 rounded-full hover:bg-slate-700"
                      th:onclick="'openProcessModal(\'' + ${process.processDefinitionName} + '\', \'' + ${process.id} + '\')'">
                <i class="fas fa-ellipsis-h"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Process Timeline Modal -->
  <div id="processModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
    <!-- Modal Container -->
    <div class="bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <!-- Modal Header -->
      <header class="px-6 py-4 border-b border-gray-600">
        <div class="flex items-center justify-between">
          <h1 class="text-xl font-bold text-white">Process Timeline</h1>
          <button id="closeModalBtn" class="text-slate-300 hover:text-white text-2xl leading-none" aria-label="Close modal">
            Ã—
          </button>
        </div>
      </header>

      <!-- Modal Content -->
      <div class="px-6 py-6">
        <!-- Task Information -->
        <section class="mb-6">
          <p class="text-base mb-2">
            <span class="font-bold text-white">Process:</span>
            <span id="modalProcessName" class="font-normal text-slate-300">Onboard New Employee</span>
          </p>
          <p class="text-base">
            <span class="font-bold text-white">ID:</span>
            <span id="modalProcessId" class="font-normal text-slate-300">TSK1001</span>
          </p>
        </section>

        <!-- Timeline -->
        <section class="space-y-6">
          <!-- Initiation Step -->
          <article class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <div class="timeline-circle timeline-circle-inactive mt-1"></div>
              <div>
                <h3 class="text-base font-medium text-white">Initiation</h3>
                <p class="text-sm text-slate-300">Assignee: Unassigned</p>
              </div>
            </div>
          </article>

          <!-- Planning Step -->
          <article class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <div class="timeline-circle timeline-circle-inactive mt-1"></div>
              <div>
                <h3 class="text-base font-medium text-white">Planning</h3>
                <p class="text-sm text-slate-300">Assignee: Unassigned</p>
              </div>
            </div>
          </article>

          <!-- Execution Step (Active) -->
          <article class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <div class="timeline-circle timeline-circle-active mt-1"></div>
              <div>
                <h3 class="text-base font-medium text-white">Execution</h3>
                <p class="text-sm text-slate-300">Assignee: Kemi Adeleke</p>
                <p class="text-sm text-slate-300">Started: 2024-05-01 09:00</p>
                <p class="text-sm text-slate-300">Due: 2024-05-10 18:00</p>
              </div>
            </div>
          </article>

          <!-- Monitoring Step -->
          <article class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <div class="timeline-circle timeline-circle-inactive mt-1"></div>
              <div>
                <h3 class="text-base font-medium text-white">Monitoring</h3>
                <p class="text-sm text-slate-300">Assignee: Unassigned</p>
              </div>
            </div>
          </article>

          <!-- Closure Step -->
          <article class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <div class="timeline-circle timeline-circle-inactive mt-1"></div>
              <div>
                <h3 class="text-base font-medium text-white">Closure</h3>
                <p class="text-sm text-slate-300">Assignee: Unassigned</p>
              </div>
            </div>
          </article>
        </section>
      </div>
    </div>
  </div>
</div>

<script>
  // Modal functionality
  const modal = document.getElementById('processModal');
  const closeModalBtn = document.getElementById('closeModalBtn');
  const modalProcessName = document.getElementById('modalProcessName');
  const modalProcessId = document.getElementById('modalProcessId');

  // Function to open modal with process data
  function openProcessModal(processName, processId) {
    // Update modal content with the selected process data
    modalProcessName.textContent = processName;
    modalProcessId.textContent = processId;

    // Show modal
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
  }

  // Function to close modal
  function closeModal() {
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto'; // Restore background scrolling
  }

  // Event listeners
  if (closeModalBtn) {
    closeModalBtn.addEventListener('click', closeModal);
  }

  // Close modal when clicking on backdrop
  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      closeModal();
    }
  });

  // Close modal with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
      closeModal();
    }
  });

  // Expose functions globally
  window.openProcessModal = openProcessModal;
  window.closeProcessModal = closeModal;
</script>
</body>
</html>
